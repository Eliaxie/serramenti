<html>
    <head>
        <script type="text/javascript">

            // This will parse a delimited string into an array of
            // arrays. The default delimiter is the comma, but this
            // can be overriden in the second argument.
            function CSVToArray( strData, strDelimiter ){
                // Check to see if the delimiter is defined. If not,
                // then default to comma.
                strDelimiter = (strDelimiter || ",");
        
                // Create a regular expression to parse the CSV values.
                var objPattern = new RegExp(
                    (
                        // Delimiters.
                        "(\\" + strDelimiter + "|\\r?\\n|\\r|^)" +
        
                        // Quoted fields.
                        "(?:\"([^\"]*(?:\"\"[^\"]*)*)\"|" +
        
                        // Standard fields.
                        "([^\"\\" + strDelimiter + "\\r\\n]*))"
                    ),
                    "gi"
                    );
        
        
                // Create an array to hold our data. Give the array
                // a default empty first row.
                var arrData = [[]];
        
                // Create an array to hold our individual pattern
                // matching groups.
                var arrMatches = null;
        
        
                // Keep looping over the regular expression matches
                // until we can no longer find a match.
                while (arrMatches = objPattern.exec( strData )){
        
                    // Get the delimiter that was found.
                    var strMatchedDelimiter = arrMatches[ 1 ];
        
                    // Check to see if the given delimiter has a length
                    // (is not the start of string) and if it matches
                    // field delimiter. If id does not, then we know
                    // that this delimiter is a row delimiter.
                    if (
                        strMatchedDelimiter.length &&
                        (strMatchedDelimiter != strDelimiter)
                        ){
        
                        // Since we have reached a new row of data,
                        // add an empty row to our data array.
                        arrData.push( [] );
        
                    }
        
        
                    // Now that we have our delimiter out of the way,
                    // let's check to see which kind of value we
                    // captured (quoted or unquoted).
                    if (arrMatches[ 2 ]){
        
                        // We found a quoted value. When we capture
                        // this value, unescape any double quotes.
                        var strMatchedValue = arrMatches[ 2 ].replace(
                            new RegExp( "\"\"", "g" ),
                            "\""
                            );
        
                    } else {
        
                        // We found a non-quoted value.
                        var strMatchedValue = arrMatches[ 3 ];
        
                    }
        
        
                    // Now that we have our value string, let's add
                    // it to the data array.
                    arrData[ arrData.length - 1 ].push( strMatchedValue );
                }
        
                // Return the parsed data.
                return( arrData );
            }
            const selectedFile = document.getElementById('fileSelect')
            function processFile(){
                console.log(document.getElementById('fileSelect').files[0])
                var reader = new FileReader();
                reader.readAsText(document.getElementById('fileSelect').files[0], "UTF-8")
                reader.onload = function (evt) {
                    console.log(CSVToArray(evt.target.result));
                }
            }
            
            let windows = [["POS", "LARGHE", "ALTEZZA", "APERTURA", "DETTAGLI", "APERT.", "VETRO", "MANIGLIA", "PEZZI", "NOTE"]];
            
            counter = 1

            function addNewWindowForm(counter){
                const windowHTML = `<section id="section1"> 
                0: <input type="text" id="`+ counter +`-0"><br>
                1: <input type="text" id="`+ counter +`-1"><br>
                2: <input type="text" id="`+ counter +`-2"><br>
                3: <input type="text" id="`+ counter +`-3"><br>
                4: <input type="text" id="`+ counter +`-4"><br>
                5: <input type="text" id="`+ counter +`-5"><br>
                6: <input type="text" id="`+ counter +`-6"><br>
                7: <input type="text" id="`+ counter +`-7"><br>
                8: <input type="text" id="`+ counter +`-8"><br>
                <input type="button" onclick="addWindow(` + counter + `)" value="Submitted">
                </section>`
                document.getElementById("frm").innerHTML = windowHTML
            }
            
            function addWindow(id){
                let window = new Array()
                for (let i = 0; i < 9; i++) {
                    window[i] = document.getElementById(id + '-' + i).value   
                }
                windows[id] = window
                counter++
                addNewWindowForm(counter)
                console.log(windows)
                printWindows(windows);
            }

            function printWindows(windows){
                for (const window of windows) {
                    console.log(window)
                    if(window == windows[0]){
                        document.getElementById("windowsContainer").innerHTML = window + "<br>"
                    } else {
                        document.getElementById("windowsContainer").innerHTML = document.getElementById("windowsContainer").innerHTML + window + `<input id="fileSelect" onchange="processFile()" class="smallbutton"/> ` + "<br>"
                    }
                }
            }

            window.addEventListener('DOMContentLoaded', (event) => {
                addNewWindowForm(counter)
            });
        </script>
    </head>
    <body>
        Importa serramenti:
        <input id="fileSelect" type="file" accept=".csv" onchange="processFile()"/>  
        <hr>
            <div id="windowsContainer">

            </div>
            <input id="fileSelect" onchange="processFile()"/>  
        <hr>
        <form id="frm">
            
        </form>
    </body>
</html>
